openapi: 3.0.0
# Added by API Auto Mocking Plugin
servers:
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/trifork-nsp/maternity-facade-api/1.0.0
info:
  version: "1.0.0"
  title: DK Maternity Facade API
  description: >
    This is the specification of the DK Maternity Facade API.
    It is a facade for the Web Services Resource Transfer DK Maternity API.
security:
  - application:
      - read
      - write
paths:
  /maternity/data-card:
    parameters:
      - in: cookie
        name: context
        required: true
        schema:
          $ref: '#/components/schemas/sessionContext'
    get:
      summary: Get data cards
      description: >
        Gets all data cards for the current patient identified in the **context** cookie.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/dataCard'
    post:
      summary: Create a data card
      responses:
        '201':
          description: Created
  /maternity/data-card/{identifier}:
    parameters:
      - in: path
        name: identifier
        schema:
          $ref: '#/components/schemas/uuidv4'
        required: true
        description: The identifier of the data card
    get:
      summary: Get a specific data card
      responses:
        '200':
          description: OK
    put:
      summary: Update a specific data card
      responses:
        '200':
          description: OK
    delete:
      summary: Delete a specific data card
      responses:
        '200':
          description: OK
components:
  schemas:
    uuidv4:
      title: Universally Unique IDentifier version 4
      description: >
        A Universally Unique IDentifier (UUID) version 4.
        See [RFC 4122, section 4.4](https://tools.ietf.org/html/rfc4122#section-4.4)
      type: string
      pattern: '[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}'
      example: 'dfa66499-40b7-4bc6-a2e5-dd3cbcd8cf68'

    uuidv5:
      title: Universally Unique IDentifier version 5
      description: >
        A Universally Unique IDentifier (UUID) version 5.
        See [RFC 4122, section 4.3](https://tools.ietf.org/html/rfc4122#section-4.3)
      type: string
      pattern: '[0-9a-f]{8}-[0-9a-f]{4}-5[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}'
      example: '8da3af4b-176e-5f53-bab2-a2b349e5229d'

    sessionContext:
      title: Session context
      description: >
        The patient and application mode encoded as a JWT
      type: object
      properties:
        header:
          type: object
          properties:
            alg:
              type: string
              enum: [HS256]
            typ:
              type: string
              enum: [JWT]
          required:
            - alg
            - typ
        payload:
          type: object
          properties:
            patient-identifier:
              $ref: '#/components/schemas/cprNumber'
            application-mode:
              $ref: '#/components/schemas/applicationMode'
          required:
            - patient-identifier
            - application-mode
        signature:
          description: The signature of the JWT
          type: string
          minLength: 44
          maxLength: 44
      required:
        - header
        - payload
        - signature
      example: >
        eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
        eyJwYXRpZW50LWlkZW50aWZpZXIiOiI5MTAzNjcyMTM0IiwiYXBwbGljYXRpb24tbW9kZSI6InN0YW5kYWxvbmUifQ.
        mu7vIUndSNn83ziXypl6zBaeI51ogCRetjS8ChOYDpc

    cprNumber:
      title: Danish national person identifier
      type: string
      pattern: '([06][1-9]|[1-25-8][0-9]|[39][0-1])(0[1-9]|1[0-2])[0-9]{6}'
      example: '9103672134'

    applicationMode:
      type: string
      enum: [standalone, embedded]

    dataCard:
      title: Maternity data card
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            episodeOfCareIdentifier:
              $ref: '#/components/schemas/uuidv5'
            recordTarget:
              $ref: '#/components/schemas/cprIdentifiedPerson'
            childPartnerSection:
              $ref: '#/components/schemas/childPartnerSection'
            languageSection:
              $ref: '#/components/schemas/languageSection'
            bodyMeasuresSection:
              $ref: '#/components/schemas/bodyMeasuresSection'
            socialHistorySection:
              $ref: '#/components/schemas/socialHistorySection'
            previousBirthsSection:
              $ref: '#/components/schemas/previousBirthsSection'
            previousAbortionsSection:
              $ref: '#/components/schemas/previousAbortionsSection'
            expectedDateOfDeliverySection:
              $ref: '#/components/schemas/expectedDateOfDeliverySection'
            prenatalRiskAssessmentSection:
              $ref: '#/components/schemas/prenatalRiskAssessmentSection'
            workEnvironmentImpactSection:
              $ref: '#/components/schemas/workEnvironmentImpactSection'
            allergiesSection:
              $ref: '#/components/schemas/allergiesSection'
            screeningsSection:
              type: object
              properties:
                hepatitisB:
                  $ref: '#/components/schemas/positiveNegativeDeclinedScreeningWithDateSection'
                hiv:
                  $ref: '#/components/schemas/positiveNegativeDeclinedScreeningWithDateSection'
                syphilis:
                  $ref: '#/components/schemas/positiveNegativeDeclinedScreeningWithDateSection'
                chlamydia:
                  $ref: '#/components/schemas/positiveNegativeScreeningWithDateSection'
                gonorrhea:
                  $ref: '#/components/schemas/positiveNegativeScreeningWithDateSection'
                streptococcusGroupB:
                  $ref: '#/components/schemas/positiveNegativeScreeningWithDateSection'
                hemoglobinopathy:
                  $ref: '#/components/schemas/positiveNegativeScreeningWithDateSection'
                vitaminDConsumption:
                  $ref: '#/components/schemas/dateValueUnitScreeningSection'
                maternalRhDAntibody:
                  $ref: '#/components/schemas/maternalRhDAntibodyScreeningSection'
                fetalRhDAntibody:
                  $ref: '#/components/schemas/fetalRhDAntibodyScreeningSection'
                diabetesWeek18To20:
                  $ref: '#/components/schemas/dateValueUnitScreeningSection'
                diabetesWeek28To30:
                  $ref: '#/components/schemas/dateValueUnitScreeningSection'
                diabetesGlycosuria:
                  $ref: '#/components/schemas/dateValueUnitScreeningSection'
                antiDImmunoglobulinGiven:
                  $ref: '#/components/schemas/yesNoDateScreeningSection'
            chronicalDiseasesSection:
              $ref: '#/components/schemas/chronicalDiseasesSection'
            medicineSection:
              allOf:
                - $ref: '#/components/schemas/versionedSection'
                - type: object
                  properties:
                    medicine:
                      type: string
            mmrVacinationSection:
              allOf:
                - $ref: '#/components/schemas/versionedSection'
                - type: object
                  properties:
                    value:
                      type: string
                      enum: [ vaccinated, notVacinnated, unknown ]
            historyOfPreviousTreatmentWithImpactOnPregnancySection:
              allOf:
                - $ref: '#/components/schemas/versionedSection'
                - type: object
                  properties:
                    history:
                      type: string

            tobaccoUseAndExposureSection:
              $ref: '#/components/schemas/tobaccoUseAndExposureSection'
          required:
            - recordTarget
            - author

    tobaccoUseAndExposureSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            exposureToEnvironmentalTobaccoSmoke:
              $ref: '#/components/schemas/yesNoEnum'
      oneOf:
        - $ref: '#/components/schemas/activeTobaccoUser'
        - $ref: '#/components/schemas/formerTobaccoUser'
        - $ref: '#/components/schemas/neverUsedTobacco'
        discriminator:
          propertyName: tobaccoUser
          mapping:
            active: '#/components/schemas/activeTobaccoUser'
            former: '#/components/schemas/formerTobaccoUser'
            never: '#/components/schemas/neverUsedTobacco'

    activeTobaccoUser:
      type: object
      properties:
        tobaccoUser:
          type: string
          enum: [ active ]
        referredToTobaccoCessationEducation:
          $ref: '#/components/schemas/yesNoEnum'
      required:
        - tobaccoUser

    formerTobaccoUser:
      type: object
      properties:
        tobaccoUser:
          type: string
          enum: [ former ]
        stoppedUsingTobacco:
          type: date
      required:
        - tobaccoUser

    neverUsedTobacco:
      type: object
      properties:
        tobaccoUser:
          type: string
          enum: [ never ]
      required:
        - tobaccoUser

    chronicalDiseasesSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            circulatorySystem:
              $ref: '#/components/schemas/yesNoEnum'
            respitorySystem:
              $ref: '#/components/schemas/yesNoEnum'
            thyroid:
              $ref: '#/components/schemas/yesNoEnum'
            diabetes:
              $ref: '#/components/schemas/yesNoEnum'


    languageSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            nationality:
              type: string
      oneOf:
        - $ref: '#/components/schemas/translationRequirements'
        - $ref: '#/components/schemas/noTranslationRequirements'
      discriminator:
        propertyName: translationRequired
        mapping:
          yes: '#/components/schemas/translationRequirements'
          no: '#/components/schemas/noTranslationRequirements'

    translationRequirements:
      type: object
      properties:
        language:
          type: string
        translationRequired:
          type: string
          enum: [yes]
      required: [translationRequired]

    noTranslationRequirements:
      type: object
      properties:
        translationRequired:
          type: string
          enum: [no]
      required: [translationRequired]

    bodyMeasuresSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            prenatalBodyWeight:
              type: object
              properties:
                value:
                  type: integer
                  minimum: 0
                unit:
                  type: string
                  enum: [ kg ]
              required:
                - value
                - unit
            bodyHeight:
              type: object
              properties:
                value:
                  type: integer
                  minimum: 0
                unit:
                  type: string
                  enum: [ cm ]
              required:
                - value
                - unit
            bodyMassIndex:
              type: object
              properties:
                value:
                  type: integer
                  minimum: 0
                unit:
                  type: string
                  enum: [ kg/m2 ]

    socialHistorySection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            maritalOrPartnershipStatus:
              type: string
              enum: [ single, married, separated, divorced, widowed ]
            livingConditions:
              type: string
              enum: [ partnership, single ]
            additionalInformations:
              type: string

    childPartnerSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - $ref: '#/components/schemas/cprIdentifiedPerson'

    previousBirthsSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: array
          items:
            type: object
            properties:
              date:
                type: string
                pattern: date
              outcome:
                type: string
                enum: [ livebirth, stillbirth]
              sex:
                type: string
                enum: [ female, male ]
              gestationLength:
                $ref: '#/components/schemas/durationInDays'
              birthWeight:
                type: object
                properties:
                  value:
                    type: integer
                    minimum: 0
                  unit:
                    type: string
                    enum: [ g ]
                required: [ value, unit ]
              birthPlace:
                type: string
              pregnancySummary:
                type: string
              birthSummary:
                type: string
              subjectiveBirthExpirience:
                type: string
                enum: [  good, normal, bad ]
              puerperalSepsis:
                type: boolean
              childsCurrentHealthStatus:
                type: string

    previousAbortionsSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: array
          items:
            type: object
            properties:
              date:
                type: string
                pattern: date
              type:
                type: string
                enum: [ spontaneous, induced ]
              gestationLength:
                type: object
                properties:
                  value:
                    type: integer
                    minimum: 0
                  unit:
                    type: string
                    enum: [ w ]
                required: [ value, unit ]
              indication:
                type: string

    expectedDateOfDeliverySection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            expectedDateOfDeliveryFromLastPeriod:
              type: object
              properties:
                lastPeriod:
                  type: string
                  pattern: date
                menstrualCycle:
                  oneOf:
                    - $ref: '#/components/schemas/durationInDays'
                    - $ref: '#/components/schemas/durationFromDates'
                expectedDateOfDelivery:
                  type: string
                  pattern: date
                certainty:
                  type: string
                  enum: [ certain, equivocal ]
            expectedDateOfDeliveryFromPrenatalUtrasoundScan:
              type: string
              pattern: date
            remarks:
              type: string

    assistedFertilizationSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            receivesFertilizationAssitance:
              type: boolean
            remarks:
              type: string

    prenatalRiskAssessmentSection:
      type: object
      properties:
        preliminaryRiskAssessment:
          allOf:
            - $ref: '#/components/schemas/versionedSection'
            - type: object
              properties:
                familyHistory:
                  type: string
                consanguinity:
                  type: boolean
                firstTrimesterUltrasoundScanOfFetusRequested:
                  type: boolean
                secondTrimesterUltrasoundScanOfFetusRequested:
                  type: boolean
                prenatalRiskAssessmentRequested:
                  type: boolean
        finalRiskAssessment:
          allOf:
            - $ref: '#/components/schemas/versionedSection'
            - type: object
              properties:
                doubleTestCompleted:
                  type: boolean
                firstTrimesterUltrasoundScanOfFetusCompleted:
                  type: boolean
                secondTrimesterUltrasoundScanOfFetusCompleted:
                  type: boolean
                downsScreeningProbabilityAssessment:
                  type: string
                placentalBiopsiObservation:
                  type: object
                  properties:
                    date:
                      type: string
                      pattern: date
                    result:
                      type: string
                prenatalAmniocentesisiObservation:
                  type: object
                  properties:
                    date:
                      type: string
                      pattern: date
                    result:
                      type: string

    workEnvironmentImpactSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            mother:
              type: object
              properties:
                jobType:
                  type: string
                hoursOfWorkPerWeek:
                  type: object
                  properties:
                    value:
                      type: integer
                      minimum: 0
                      maximum: 168
                    unit:
                      type: string
                      enum: [ h/wk ]
                ergonomicalWorkEnvironmentalImpact:
                  allOf:
                    - $ref: '#/components/schemas/exposureToWorkEnvironmentRisk'
                chemicalWorkEnvironmentalImpact:
                  allOf:
                    - $ref: '#/components/schemas/exposureToWorkEnvironmentRisk'
                biologicalWorkEnvironmentalImpact:
                  allOf:
                    - $ref: '#/components/schemas/exposureToWorkEnvironmentRisk'
                otherWorkEnvironmentalImpact:
                  allOf:
                    - $ref: '#/components/schemas/exposureToWorkEnvironmentRisk'
                referredToOccupationalHealthDepartmentForRiskAssessment:
                  type: boolean
                prenatalSickLeave:
                  type: string
                  enum: [ none, partial, full ]
            partner:
              type: object
              properties:
                jobType:
                  type: string

    exposureToWorkEnvironmentRisk:
      allOf:
        - $ref: '#/components/schemas/durationFromDates'
        - type: object
          properties:
            remarks:
              type: string

    allergiesSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            allergiesOfMother:
              type: array
              items:
                type: string
            allergicPredispositionOfChild:
              type: string
              enum:
                - noPredisposition
                - parentalPredisposition
                - siblingPredisposition
                - doublePredisposition

    positiveNegativeDeclinedScreeningWithDateSection:
      allOf:
        - $ref: '#/components/schemas/dateScreeningSection'
        - type: object
          properties:
            result:
              type: string
              enum: [ positive, negative, declined ]

    positiveNegativeScreeningWithDateSection:
      allOf:
        - $ref: '#/components/schemas/dateScreeningSection'
        - type: object
          properties:
            result:
              $ref: '#/components/schemas/posNegEnum'

    dateValueUnitScreeningSection:
      allOf:
        - $ref: '#/components/schemas/dateScreeningSection'
        - type: object
          properties:
            value:
              type: integer
            unit:
              type: string

    dateScreeningSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            date:
              type: string
              pattern: date

    maternalRhDAntibodyScreeningSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            bloodSampleTaken:
              $ref: '#/components/schemas/yesNoEnum'
            rhesusType:
              $ref: '#/components/schemas/posNegEnum'
            irregularBloodGroupAntibodyOresent:
              $ref: '#/components/schemas/posNegEnum'

    fetalRhDAntibodyScreeningSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - type: object
          properties:
            rhesusType:
              $ref: '#/components/schemas/posNegEnum'
            antiDIsoimmunizationAffectingPregnancy:
              $ref: '#/components/schemas/posNegEnum'

    yesNoDateScreeningSection:
      allOf:
        - $ref: '#/components/schemas/dateScreeningSection'
        - $ref: '#/components/schemas/yesNoValue'

    yesNoVersionedSection:
      allOf:
        - $ref: '#/components/schemas/versionedSection'
        - $ref: '#/components/schemas/yesNoValue'

    cprIdentifiedPerson:
      allOf:
        - $ref: '#/components/schemas/person'
        - type: object
          properties:
            identifier:
              $ref: '#/components/schemas/cprNumber'
          required:
            - identifier

    durationInDays:
      type: object
      properties:
        value:
          type: integer
          minimum: 0
        unit:
          type: string
          enum: [ d ]
      required: [ value, unit ]

    durationFromDates:
      type: object
      properties:
        start:
          type: string
          pattern: date
        end:
          type: string
          pattern: date
        calculated:
          $ref: '#/components/schemas/durationInDays'

    person:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/personName'
      required:
        - name

    personName:
      type: object
      properties:
        firstNames:
          type: array
          items:
            type: string
          minItems: 1
        middleNames:
          type: array
          items:
            type: string
        lastName:
          type: string
      required:
        - firstNames
        - middleNames
        - lastName

    yesNoValue:
      type: object
      properties:
        value:
          $ref: '#/components/schemas/yesNoEnum'
    yesNoEnum:
      type: string
      enum: [ yes, no ]

    posNegEnum:
      type: string
      enum: [ positive, negative ]


    healthCareActor:
      oneOf:
        - $ref: '#/components/schemas/healthCareProfessional'
        - $ref: '#/components/schemas/healthCareOrganization'
      discriminator:
        propertyName: objectType

    healthCareProfessional:
      allOf:
        - $ref: '#/components/schemas/person'
        - type: object
          properties:
            objectType:
              type: string
              enum:
                - healthCareProfessional
          required:
            - objectType

    healthCareOrganization:
      type: object
      properties:
        name:
          type: string
        objectType:
          type: string
          enum:
            - healthCareOrganization
      required:
        - name
        - objectType

    versionedSection:
      type: object
      properties:
        modifiedTime:
          type: string
          pattern: date-time
        author:
          $ref: '#/components/schemas/healthCareActor'

  securitySchemes:
    application:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: 'http://example.com/oauth/token'
          scopes:
            write: allows modifying resources
            read: allows reading resources